---
title: "Reflection"
author: "Tahmid Ahmed"
date: "11/23/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r data, echo=FALSE, message=FALSE, warning=FALSE}
# Load libraries
library(tidyverse)
library(caret)
library(statebins)
library(usmap)
library(stargazer)
library(cowplot)
library(sjPlot)
library(magrittr)
library(scales)
library(performance)
library(gt)
library(plotly)
library(grid)
library(gridExtra)
```

### Overview

Now that the 2020 election is officially over and Biden was elected as the President of the United States, it is important that I reflect on my prediction model. I am excited to see how I cold learn from my model for future models that I create. 

### Model Recap

Let's first recap on my prediction model to get a better picture of what it was. 

* My prediction model was an **ensemble model** that predicted the popular vote share for each state
.
* Given that the Time For Change Model was an inspiration, I decided to focus my model on historical republican vote share as Trump was the incumbent for the 2020 election and incumbency was one predictor in the Time For Change Model.

* I decided to separate America into three categories - red states, blue states, and battleground states - for my model to adjust for overfitting. The grouping were based on how FiveThirtyEight grouped states. 
  + Red States - AK, IN, KS, MO, AL, AR, ID, KY, LA, MS, ND, OK, SD, MT, TN, WV, WY, SC, UT, NE
  + Blue States - CO, VA, CA, CT, DE, HI, IL, MD, MA, NJ, NY, OR, RI, VT, WA, ME, NM, NH
  + Battleground states - FL, IA, OH, GA, NC, MI, MN, PA, WI, NV, AZ, TX
  
* My model used the following data:
  + Historical polling, approval, and turnout data was based on data given from class
  + Historical and present economic data was sourced from the Bureau of Economic Analysis
  + Present polling and approval data was based on FiveThirtyEightâ€™s forecast data
  
* In my model, I decided to classify approval, Q2 GDP growth, and turnout as fundamentals

* Thus, **my ensemble model weighted the poll model (using only polls) by 0.96 and the fundamental model (using only fundamentals) by 0.04** as I weighted the model based on FiveThirtyEight's reasoning that polls are better predictors as the election nears since fundamentals become more noisy instead.

* My final prediction using the ensemble model was that **Biden was projected to win 310 electoral votes while Trump is projected to win 228 votes**, meaning Biden would become president-elect of the United States.

### Patterns and Accuracy





```{r join,echo=FALSE, message=FALSE, warning=FALSE}
# Read data needed
myprediction <- read_csv("/Users/tahmidahmed/Desktop/Gov 1347/Gov1347/data/pred_ensemble.csv")
popvote <- read_csv("/Users/tahmidahmed/Desktop/Gov 1347/Gov1347/data/popvote_bystate_1948-2020.csv") %>%
  filter(year == 2020)
popvote$state <- state.abb[match(popvote$state, state.name)] 
popvote$R_pv2p <- popvote$R_pv2p * 100

# Join data
joined <- myprediction %>%
  left_join(popvote, by = "state") %>%
  mutate(winner_pv = ifelse(R_pv2p > 50, "Republican", "Democrat")) %>%
  mutate(diff = R_pv2p - pred)
```

```{r joinedplot, echo=FALSE, warning=FALSE}
# Plotting actual vs predicted state pv2p
joined_plot <- joined %>% 
  ggplot(aes(x = pred, y = R_pv2p, color = winner_pv, labels = state)) +
  geom_point() + 
  geom_abline() +
  scale_color_manual(values = c(muted("blue"), "red3")) +
  scale_x_continuous(labels = percent_format(accuracy = 1, scale = 1), limits = c(25, 95), breaks = c(30, 40, 50, 60, 70, 80, 90)) +
  scale_y_continuous(labels = percent_format(accuracy = 1, scale = 1), limits = c(25, 95), breaks = c(30, 40, 50, 60, 70, 80, 90)) +
  theme_classic() +
  theme(legend.position = "none") +
  labs(title = "Actual vs Predicted Trump Two-Party Popular Vote per State",
       x = "Predicted Trump Two-Party Popular Vote",
       y = "Actual Trump Two-Party Popular Vote")

# Switching to plotly
ggplotly(joined_plot, tooltip = c("state", "R_pv2p", "pred"))
```



```{r, echo=FALSE}
# Calculating the mse and rmse for all states
mse_all = sum(joined$diff**2) / nrow(joined)
rmse_all = sqrt(mse_all)
```



```{r, echo=FALSE, warning=FALSE, fig.height = 5, fig.width = 10}
# Plot results of ensemble model
pred_map <- plot_usmap(data = joined, regions = "states", values = "winner") +
  scale_fill_manual(breaks = c("Democrat", "Republican"),
                    values = c(muted("blue"), "red3")) +
  theme_void() +
  labs(fill = "Political Party",
       title = "2020 Presidential Election Prediction Map",
       subtitle = "Weighting = 0.96*Poll + 0.04*Fundamental")

# Plot results of actual results
actual_map <- plot_usmap(data = joined, regions = "states", values = "winner_pv") +
  scale_fill_manual(breaks = c("Democrat", "Republican"),
                    values = c(muted("blue"), "red3")) +
  theme_void() +
  labs(fill = "Political Party",
       title = "2020 Presidential Election Actual Map",
       subtitle = "Live Update")

grid.arrange(pred_map, actual_map, ncol = 2)


```

```{r, echo=FALSE, warning=FALSE}
# Plot forecast error
joined$hover <- with(joined, paste(state, '<br>'))

# give state boundaries a white border
l <- list(color = toRGB("white"), width = 2)
# specify some map projection/options
g <- list(
  scope = 'usa',
  projection = list(type = 'albers usa'),
  showlakes = TRUE,
  lakecolor = toRGB('white')
)

plot_geo(joined, locationmode = 'USA-states') %>%
  add_trace(
  z = ~diff, text = ~hover, locations = ~state,
  color = ~diff, colors = 'Purples') %>%
  layout(
    title = "Difference between Trump's actual and predicted two party vote share <br>(Hover for breakdown)",
    geo = g) %>% colorbar(title = "Difference")
```

```{r, echo=FALSE}
# generating histograms
ggplotly(
joined %>% 
    ggplot(aes(diff)) +
    geom_histogram(aes(y = after_stat(count / sum(count))), bins = 10, fill = '#BE1E26') + 
    geom_vline(xintercept = 0, linetype = "dashed") +
    labs(x = "Difference Between Trump's Actual and Predicted \nTwo-Party Vote Share",
         y = "Count",
         title = "Error Distributions for Model") +
    theme_classic())
```




